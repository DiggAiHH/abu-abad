# üîé Gr√ºndliche Code-Analyse (2026-01-21)

## 0) Kontext & Quellen (evidence)
- Runbook/Status: [/.laufbahn/LAUFBAHN.md](.laufbahn/LAUFBAHN.md)
- Projektstatus (Docker/Tests): [STATUS.md](STATUS.md)
- Fix-Historie: [FINAL_STATUS_REPORT.md](FINAL_STATUS_REPORT.md)
- Offene Tasks: [/.laufbahn/PENDING_TASKS.md](.laufbahn/PENDING_TASKS.md)
- Login-UX-Testhinweis: [tests/e2e/login.spec.ts](tests/e2e/login.spec.ts)
- Error-Reporting: [apps/backend/src/routes/error.routes.ts](apps/backend/src/routes/error.routes.ts)
- Logger/PII-Redaction: [apps/backend/src/utils/logger.ts](apps/backend/src/utils/logger.ts)
- Demo-Seed (Credentials-Output): [apps/backend/src/database/seed_doctor_demo.ts](apps/backend/src/database/seed_doctor_demo.ts)
- Toolchain/Scripts: [package.json](package.json)

---

## 1) Was funktioniert (belegt)
- Frontend-Build erfolgreich + dist erzeugt (laut Runbook).
- Backend-Tests sind vorbereitet (Vitest-Konfig + Test-Files vorhanden).
- i18n-Struktur inkl. RTL-Support ist implementiert (laut Runbook/Docs).
- Error-Boundary + lokales Error-Reporting vorhanden.

**Belege:** [/.laufbahn/LAUFBAHN.md](.laufbahn/LAUFBAHN.md), [FINAL_STATUS_REPORT.md](FINAL_STATUS_REPORT.md)

---

## 2) Was nicht verifiziert / instabil ist
- **Deployment** ist nicht durchgef√ºhrt (Netlify/Railway manuell ausstehend).
- **Tests**: Docker/E2E zeigen 106 Fails (Timeouts). Das ist technisch kein funktionaler Fail, aber **Test-Infra instabil**.

**Belege:** [/.laufbahn/LAUFBAHN.md](.laufbahn/LAUFBAHN.md), [STATUS.md](STATUS.md)

---

## 3) Offene Aufgaben (realistisch, priorisiert)
**Aus [/.laufbahn/PENDING_TASKS.md](.laufbahn/PENDING_TASKS.md) extrahiert:**
- üî¥ High: Backend-Deploy (Railway), DB-Migration, CORS Finalisierung
- üü° Medium: Backend-Tests ausf√ºhren + Coverage, Security Header Audit
- üü¢ Low: Stripe Webhook, PeerJS Server, Logging-Audit, DB-Migration-Tests

**Zusatz ‚Äì Test-Matrix offen:**
- Mehrere E2E/Integration-Tests als TODO markiert (u.a. Registration, PeerJS).

**Belege:** [/.laufbahn/PENDING_TASKS.md](.laufbahn/PENDING_TASKS.md), [ATOMIC_TESTING_MATRIX_V2.md](ATOMIC_TESTING_MATRIX_V2.md)

---

## 4) Aufgaben, die **allein** nicht ausreichen (L√ºcken)
1) **GDPR/DSGVO Compliance-L√ºcken**
   - AVV f√ºr Stripe & Email-Provider fehlen explizit.
   - Breach-Notification/Audit-Log noch als TODO.
   **Belege:** [GDPR_COMPLIANCE_REPORT.md](GDPR_COMPLIANCE_REPORT.md), [IMPLEMENTATION_PLAN_V8.md](IMPLEMENTATION_PLAN_V8.md)

2) **Tests = nicht belastbar in Docker**
   - Viele Fails durch Timeouts ‚Üí Test-Setup/CI-Profile m√ºssen getrennt (Local vs Docker) werden.
   **Belege:** [STATUS.md](STATUS.md)

3) **Legacy-Code-Duplikate**
   - Es existieren alte Backend-Pfade unter [backend/](backend/) zus√§tzlich zu [apps/backend/](apps/backend/). Risiko: Doppel-Config, doppelte Logs, falscher Start.

---

## 5) Fehler- & UI-Risiken (Zukunft)
1) **Login-UX:** Submit-Button nicht zuverl√§ssig disabled (Race-Condition-Test ist skip). ‚Üí Risk: Doppelte Submits.
   **Beleg:** [tests/e2e/login.spec.ts](tests/e2e/login.spec.ts)

2) **PII in Logs (Legacy-Pfad):** In [backend/](backend/) gibt es zahlreiche `console.*`-Logs, teilweise mit IDs/Emails aus Requests. Falls dieser Code im Deploy genutzt wird: DSGVO-Risiko.

3) **Demo-Credentials Output:** Seed-Script schreibt Demo-Zugangsdaten in stdout. Das ist ok in Dev/Test, aber muss in Prod blockiert werden.
   **Beleg:** [apps/backend/src/database/seed_doctor_demo.ts](apps/backend/src/database/seed_doctor_demo.ts)

4) **Error Reports:** Frontend sendet Error-Report (User-Agent/URL). Backend sanitisiert, aber **Rate-Limit**/Retention fehlen.
   **Belege:** [apps/frontend/src/components/ErrorBoundary.tsx](apps/frontend/src/components/ErrorBoundary.tsx), [apps/backend/src/routes/error.routes.ts](apps/backend/src/routes/error.routes.ts)

---

## 6) Verbesserungen (konkret, low-risk)
- **Audit der Logs**: Alle `console.*` in produktivem Code durch `logger.*` ersetzen (Redaction aktiv). Fokus: [apps/backend/](apps/backend/) und Legacy [backend/](backend/).
- **Test-Stabilisierung**: Separate Test-Profile mit h√∂heren Timeouts f√ºr Docker; CI-Profile f√ºr Headless/Video-Mocking.
- **Login-UX fix**: Button disabled w√§hrend async Login + E2E-Test wieder aktivieren.
- **Retention/Rate-Limit** f√ºr Error-Reports + DSGVO-L√∂schkonzept dokumentieren.

---

## 6.1) Codespace-Instabilit√§t ‚Äì wahrscheinliche Ursachen + Mitigation
**Ursachen (wahrscheinlich):**
- Parallel laufende Prozesse (Vite + Backend + Playwright) ‚Üí RAM/CPU-Spikes.
- Gro√üe Test-Suites mit Video/Browser-Contexts ‚Üí hohe Speicherlast.
- Docker-Compose + Playwright gleichzeitig ‚Üí IO/FS-Pressure.

**Mitigation (evidence-based, low-risk):**
- Nur **einen** schweren Prozess gleichzeitig (zuerst `validate`, dann `run-tests`).
- Playwright in **shards** oder selektiv (Auth/i18n zuerst).
- Headless + Video/Trace nur bei Bedarf.
- `NODE_OPTIONS=--max-old-space-size=2048` f√ºr Tests.
- Cleanup: alte Prozesse/Ports vor jedem Test-Lauf schlie√üen.

---

## 7) ‚ÄûCode benutzen‚Äú ‚Äì sicherer Startpfad (ohne Halluzination)
**Plan (nur Planung, keine Ausf√ºhrung):**
1. `validate.sh` ausf√ºhren (Health/Ports/Env).
2. `npm run dev` (Frontend/Backend parallel).
3. Smoke: `/api/health` + UI-Login.
4. Danach gezielte Tests (Auth + i18n + Error-Boundary).

**Hinweis:** Ohne `.env` + DB-URL schl√§gt Schritt 1-3 fehl.

---

## 8) VS Code Extensions (kostenlos, Effizienz)
- **ESLint**: Code-Standards/CI-Alignment
- **Playwright Test for VSCode**: E2E schneller debuggen
- **Docker**: Container-Logs/Status
- **GitHub Actions**: CI Status direkt im Editor

---

## 9) N√§chste Aufgabenliste (synchron mit Runbook)
1. **Test-Neustart**: `validate.sh` + `run-tests.sh` (Evidence nach `buildLogs/`).
2. **Deploy**: Frontend Netlify + Backend Railway (CORS finalisieren).
3. **Legacy-Cleanup**: Entscheidung, ob [backend/](backend/) entfernt/deprecated bleibt.
4. **Log-Audit**: `console.*` entfernen/ersetzen (DSGVO).
5. **Login-UX Fix + Test**.

---

## 10) Status
**Analyse abgeschlossen.** Keine Code-√Ñnderungen durchgef√ºhrt.
